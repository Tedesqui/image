<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Pet Virtual em RA (Sem Marcador)</title>
    
    <!-- A-Frame é a única biblioteca necessária para WebXR -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        /* Estilo para a sobreposição de instruções */
        #instructions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 400px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            text-align: center;
            padding: 15px;
            box-sizing: border-box;
            z-index: 10;
            font-size: 16px;
            border-radius: 10px;
        }

        /* O botão de entrada em RA é estilizado automaticamente pelo A-Frame, mas podemos ajustar */
        .a-enter-ar-button {
            bottom: 20px !important;
            top: auto !important;
        }
    </style>
</head>
<body style="margin : 0px; overflow: hidden;">
    
    <!-- Sobreposição com instruções para o utilizador -->
    <div id="instructions">
        Mova o telemóvel para encontrar uma superfície.
    </div>

    <!-- A cena de Realidade Aumentada -->
    <!-- `webxr` ativa o modo de RA sem marcadores -->
    <!-- `ar-hit-test` permite encontrar superfícies no mundo real -->
    <a-scene
        webxr="requiredFeatures: hit-test,local-floor; optionalFeatures: dom-overlay; overlayElement: #instructions"
        ar-hit-test="enabled: true"
        renderer="logarithmicDepthBuffer: true; antialias: true; colorManagement: true;">

        <!-- Recursos a serem pré-carregados -->
        <a-assets>
            <img id="shadow-texture" src="https://raw.githubusercontent.com/aframevr/aframe/v1.0.4/examples/boilerplate/vr-logo/assets/radial-shadow-2.png">
        </a-assets>

        <!-- Câmera da cena -->
        <a-camera position="0 1.6 0"></a-camera>

        <!-- O nosso pet virtual. Inicialmente invisível e fora da vista. -->
        <!-- Envolvemos o pet e a sombra numa entidade pai para movê-los juntos -->
        <a-entity id="pet-container" position="0 -10 0" visible="false">
            <!-- O corpo do nosso pet virtual (uma esfera) -->
            <a-entity id="pet-body" position="0 0.75 0" geometry="primitive: sphere; radius: 0.4;" material="color: #FFD700; metalness: 0.3; roughness: 0.4;">
                
                <!-- Olho esquerdo -->
                <a-sphere position="-0.15 0.15 0.3" radius="0.08" color="#222222"></a-sphere>
                
                <!-- Olho direito -->
                <a-sphere position="0.15 0.15 0.3" radius="0.08" color="#222222"></a-sphere>

                <!-- Brilho no olho esquerdo -->
                <a-sphere position="-0.12 0.18 0.35" radius="0.03" color="white"></a-sphere>

                <!-- Brilho no olho direito -->
                <a-sphere position="0.18 0.18 0.35" radius="0.03" color="white"></a-sphere>

                <!-- Animação de flutuação contínua -->
                <a-animation
                    attribute="position"
                    to="0 0.85 0"
                    dur="1500"
                    direction="alternate"
                    repeat="indefinite"
                    easing="ease-in-out-sine">
                </a-animation>

                <!-- Animação de pulo (ativada ao clicar) -->
                <a-animation
                    begin="click"
                    attribute="position"
                    from="0 0.75 0"
                    to="0 1.5 0"
                    dur="200"
                    direction="alternate"
                    repeat="1"
                    easing="ease-out-quad">
                </a-animation>
            </a-entity>

            <!-- Uma sombra simples para dar profundidade -->
            <a-plane position="0 0.01 0" rotation="-90 0 0" width="1.5" height="1.5" material="src: #shadow-texture; transparent: true; opacity: 0.6;"></a-plane>
        </a-entity>

    </a-scene>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sceneEl = document.querySelector('a-scene');
            const petContainer = document.getElementById('pet-container');
            const instructions = document.getElementById('instructions');
            let petPlaced = false;

            // Quando o utilizador toca no ecrã
            sceneEl.addEventListener('click', (event) => {
                // Se já colocámos o pet, não fazemos nada
                if (petPlaced) return;

                // `ar-hit-test` dispara um evento com os resultados
                // Usamos o primeiro resultado para obter a posição
                const hitTestResults = event.detail.intersection;
                if (hitTestResults) {
                    const hitPoint = hitTestResults.point;
                    
                    // Posiciona o container do pet no ponto onde o utilizador tocou
                    petContainer.setAttribute('position', hitPoint);
                    petContainer.setAttribute('visible', 'true');
                    
                    petPlaced = true;
                    instructions.textContent = 'Toque no seu pet para o fazer pular!';
                }
            });

            // Adiciona um evento de clique ao corpo do pet
            document.getElementById('pet-body').addEventListener('click', function (evt) {
                console.log('Pet clicado! A iniciar animação de pulo.');
                // Impede que o clique se propague para a cena, para não tentar colocar o pet novamente
                evt.stopPropagation();
            });
        });
    </script>
</body>
</html>
